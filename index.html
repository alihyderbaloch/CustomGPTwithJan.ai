<!DOCTYPE html>
<html>
<head>
    <title>My GPT</title>
</head>
<body style="background: #fffae6; font-family: Arial; text-align:center;">

    <h1>My GPT</h1>

    <div id="chat-box" style="width: 90%; max-width: 600px; margin: auto; height: 400px; overflow-y: auto; background: #fff; border: 2px solid #000; padding: 10px;">
    </div>

    <textarea id="prompt" placeholder="Type message here..." style="width: 90%; height: 50px; margin-top: 10px;"></textarea>
    <br>
    <button onclick="sendPrompt()" style="margin-top:10px; padding: 10px 20px; font-size:16px;">Send</button>

    <script>
        async function sendPrompt() {
            const prompt = document.getElementById("prompt").value.trim();
            if (!prompt) return;

            const chatBox = document.getElementById("chat-box");

            // Show user message
            const userDiv = document.createElement("div");
            userDiv.textContent = "You: " + prompt;
            userDiv.style.background = "#cceeff";
            userDiv.style.margin = "5px";
            userDiv.style.padding = "5px";
            chatBox.appendChild(userDiv);

            document.getElementById("prompt").value = "";

            // Show bot thinking
            const botDiv = document.createElement("div");
            botDiv.textContent = "GPT: thinking...";
            botDiv.style.background = "#ddffdd";
            botDiv.style.margin = "5px";
            botDiv.style.padding = "5px";
            chatBox.appendChild(botDiv);

            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const res = await fetch("/api/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: prompt })
                });

                let data;
                try {
                    data = await res.json();
                } catch (err) {
                    data = { choices: [{ message: { content: "Error: Invalid JSON response" } }] };
                }

                const reply = data.choices?.[0]?.message?.content || data.error || "No response";
                botDiv.textContent = "GPT: " + reply;
                chatBox.scrollTop = chatBox.scrollHeight;

            } catch (err) {
                botDiv.textContent = "GPT: Error fetching response";
            }
        }
    </script>
</body>
</html>
